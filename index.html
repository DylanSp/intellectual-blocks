<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>Intellectual Blocks</title>
  </head>
  <body>
    <div class="instructions">
      Click any shape to pick it up, move your mouse to relocate it to the
      workspace, then click again to set it down.
    </div>

    <div id="workspace">
      <div id="tray">
        <!-- inline styles on pieces set their initial position within the tray -->
        <div class="shape z-shape" style="left: 10px; top: 10px">
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
        </div>

        <div class="shape square-2x2" style="left: 110px; top: 10px">
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
        </div>

        <div class="shape t-shape" style="left: 180px; top: 10px">
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
        </div>

        <div class="shape line-3" style="left: 280px; top: 10px">
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
        </div>

        <div class="shape line-2" style="left: 380px; top: 10px">
          <div class="square"></div>
          <div class="square"></div>
        </div>

        <div class="shape l-shape-4" style="left: 450px; top: 10px">
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
        </div>

        <div class="shape single" style="left: 520px; top: 10px">
          <div class="square"></div>
        </div>

        <div class="shape l-shape-3" style="left: 10px; top: 110px">
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
        </div>

        <div class="shape line-4" style="left: 90px; top: 110px">
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
          <div class="square"></div>
        </div>
      </div>
    </div>

    <script>
      const workspace = document.getElementById("workspace");
      const tray = document.getElementById("tray");
      let pickedShape = null;
      let offsetX = 0;
      let offsetY = 0;
      const shapeOriginalPositions = new Map();

      // Initialize shapes - store original positions
      document.querySelectorAll(".shape").forEach((shape) => {
        // Store original position
        shapeOriginalPositions.set(shape, {
          left: shape.style.left,
          top: shape.style.top,
        });
      });

      // Handle shape clicks
      document.addEventListener("click", function (e) {
        const shape = e.target.closest(".shape");

        if (shape && !pickedShape) {
          // Pick up the shape
          pickedShape = shape;
          pickedShape.classList.add("picked-up");

          const rect = shape.getBoundingClientRect();
          offsetX = e.clientX - rect.left;
          offsetY = e.clientY - rect.top;
        } else if (pickedShape) {
          // Set down the shape
          pickedShape.classList.remove("picked-up");
          pickedShape = null;
        }
      });

      // Handle mouse movement
      document.addEventListener("mousemove", function (e) {
        if (pickedShape) {
          // Move to workspace if not already there
          if (!pickedShape.classList.contains("in-workspace")) {
            pickedShape.classList.add("in-workspace");
            const originalPos = shapeOriginalPositions.get(pickedShape);
            const trayRect = tray.getBoundingClientRect();
            const workspaceRect = workspace.getBoundingClientRect();

            // Convert tray-relative position to workspace-relative position
            const absoluteLeft =
              trayRect.left - workspaceRect.left + parseInt(originalPos.left);
            const absoluteTop =
              trayRect.top - workspaceRect.top + parseInt(originalPos.top);

            pickedShape.style.left = absoluteLeft + "px";
            pickedShape.style.top = absoluteTop + "px";

            workspace.appendChild(pickedShape);
          }

          const workspaceRect = workspace.getBoundingClientRect();
          let newX = e.clientX - workspaceRect.left - offsetX;
          let newY = e.clientY - workspaceRect.top - offsetY;

          // Keep shape within workspace bounds
          newX = Math.max(
            0,
            Math.min(newX, workspace.clientWidth - pickedShape.offsetWidth)
          );
          newY = Math.max(
            0,
            Math.min(newY, workspace.clientHeight - pickedShape.offsetHeight)
          );

          pickedShape.style.left = newX + "px";
          pickedShape.style.top = newY + "px";
        }
      });
    </script>
  </body>
</html>
